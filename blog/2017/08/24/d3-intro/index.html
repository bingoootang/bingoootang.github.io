<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>D3.js 入门简介 | Bingooo.Tang 的日志</title>
    <meta name="description" content="d3.js,D3.js,ECharts,HighCharts,G2">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.45fd1eb4.css" as="style"><link rel="preload" href="/assets/js/app.1a92a99b.js" as="script"><link rel="preload" href="/assets/js/2.4bb95436.js" as="script"><link rel="preload" href="/assets/js/22.825b5c65.js" as="script"><link rel="preload" href="/assets/js/9.60a9ad14.js" as="script"><link rel="prefetch" href="/assets/js/10.ff19f3cc.js"><link rel="prefetch" href="/assets/js/11.e260adce.js"><link rel="prefetch" href="/assets/js/12.e1d4dc76.js"><link rel="prefetch" href="/assets/js/13.3780b65b.js"><link rel="prefetch" href="/assets/js/14.821eca39.js"><link rel="prefetch" href="/assets/js/15.947a489c.js"><link rel="prefetch" href="/assets/js/16.31117fc6.js"><link rel="prefetch" href="/assets/js/17.aa761a41.js"><link rel="prefetch" href="/assets/js/18.38e91cd9.js"><link rel="prefetch" href="/assets/js/19.2f0ddeb0.js"><link rel="prefetch" href="/assets/js/20.98a05b39.js"><link rel="prefetch" href="/assets/js/21.12bee07e.js"><link rel="prefetch" href="/assets/js/23.5a7523f8.js"><link rel="prefetch" href="/assets/js/24.d4db672e.js"><link rel="prefetch" href="/assets/js/25.9dc639ba.js"><link rel="prefetch" href="/assets/js/26.bb89ef52.js"><link rel="prefetch" href="/assets/js/27.9b952333.js"><link rel="prefetch" href="/assets/js/28.36b12119.js"><link rel="prefetch" href="/assets/js/29.b3fc89ab.js"><link rel="prefetch" href="/assets/js/3.914428ae.js"><link rel="prefetch" href="/assets/js/30.8403f552.js"><link rel="prefetch" href="/assets/js/31.3a71fc7c.js"><link rel="prefetch" href="/assets/js/32.f63547d0.js"><link rel="prefetch" href="/assets/js/33.30c37fb4.js"><link rel="prefetch" href="/assets/js/34.b1e97f3f.js"><link rel="prefetch" href="/assets/js/35.ab2a7a8c.js"><link rel="prefetch" href="/assets/js/36.5d422d5b.js"><link rel="prefetch" href="/assets/js/37.839e7d79.js"><link rel="prefetch" href="/assets/js/38.72e8bf2f.js"><link rel="prefetch" href="/assets/js/39.9a05368b.js"><link rel="prefetch" href="/assets/js/4.5c559b86.js"><link rel="prefetch" href="/assets/js/40.a8400673.js"><link rel="prefetch" href="/assets/js/41.ead2592b.js"><link rel="prefetch" href="/assets/js/42.2b99ba39.js"><link rel="prefetch" href="/assets/js/43.340f4287.js"><link rel="prefetch" href="/assets/js/44.6bf6391c.js"><link rel="prefetch" href="/assets/js/45.c33e2690.js"><link rel="prefetch" href="/assets/js/46.acfb4c4c.js"><link rel="prefetch" href="/assets/js/47.0d284677.js"><link rel="prefetch" href="/assets/js/48.7e5faf9d.js"><link rel="prefetch" href="/assets/js/49.70243ee5.js"><link rel="prefetch" href="/assets/js/5.4f064dd5.js"><link rel="prefetch" href="/assets/js/50.a70d1e3a.js"><link rel="prefetch" href="/assets/js/51.54705e9f.js"><link rel="prefetch" href="/assets/js/52.5e8b3d7e.js"><link rel="prefetch" href="/assets/js/53.03656bc8.js"><link rel="prefetch" href="/assets/js/54.d3b3024e.js"><link rel="prefetch" href="/assets/js/55.b8b66fcf.js"><link rel="prefetch" href="/assets/js/56.bcc27a01.js"><link rel="prefetch" href="/assets/js/57.dd12e611.js"><link rel="prefetch" href="/assets/js/6.8113e0b5.js"><link rel="prefetch" href="/assets/js/7.222800b2.js"><link rel="prefetch" href="/assets/js/8.84f16d44.js">
    <link rel="stylesheet" href="/assets/css/0.styles.45fd1eb4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Bingooo.Tang 的日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">教程</a></div><div class="nav-item"><a href="/tools/" class="nav-link">工具</a></div> <a href="https://github.com/bingoootang" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">教程</a></div><div class="nav-item"><a href="/tools/" class="nav-link">工具</a></div> <a href="https://github.com/bingoootang" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="content default"><h1 id="d3-js-入门简介"><a href="#d3-js-入门简介" aria-hidden="true" class="header-anchor">#</a> D3.js 入门简介</h1> <p>在css中，通过模式匹配规则来决定给随着公司数据业务的发展，业务对前端数据可视化能力的要求也越来越高。现在市面上有很多成熟的图表库，比如 <a href="https://www.highcharts.com/" target="_blank" rel="noopener noreferrer">HighCharts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="http://echarts.baidu.com/" target="_blank" rel="noopener noreferrer">ECharts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://antv.alipay.com/g2/doc/index.html" target="_blank" rel="noopener noreferrer">G2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这些图表库都有着完善的封装、开箱即用的文档，基本可以覆盖我们大部分的日常开发需要。但是，在这些图表库中，除了 G2 保留了一定的定制能力以外，大部分图表库都是按照图表的类型来划分实现的。也就是说我们只能使用图表库提供的图表，无法在此基础上进行定制，而这在很多时候恰好是影响我们开发效率的地方。<br>
为了能覆盖到日常开发过程中的绝大部分场景，有必要学习一波更为底层的图表库 <a href="https://d3js.org/" target="_blank" rel="noopener noreferrer">D3.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。之所以说 D3 更为底层，是因为 D3 并没有对图表进行归类，D3 只是一个 JavaScript 库，开发者可以通过 D3 来方便的操作 DOM，绘制任何想绘制的图形。文档树中的元素应用什么样的样式。这些模式规则就被称为选择器。一个选择器可能只是一个单一的元素名称，也可能是包含复杂上下文的模式规则集合。如果一个元素满足一个选择器中的所有条件，我们就称这个选择器选中了该元素。</p> <h2 id="before-you-go"><a href="#before-you-go" aria-hidden="true" class="header-anchor">#</a> Before You Go</h2> <p>除了前面列举的一些图表库以外，大家经常听到的数据可视化相关的名词应该还有 <a href="https://threejs.org/" target="_blank" rel="noopener noreferrer">Three.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://zh.wikipedia.org/wiki/%E5%8F%AF%E7%B8%AE%E6%94%BE%E5%90%91%E9%87%8F%E5%9C%96%E5%BD%A2" target="_blank" rel="noopener noreferrer">SVG<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://zh.wikipedia.org/wiki/Canvas_(HTML%E5%85%83%E7%B4%A0)" target="_blank" rel="noopener noreferrer">Canvas<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 等。那么他们之间有什么关系呢？或者说，他们之前有什么不同呢？<br>
首先，我们知道 SVG 和 Canvas 是浏览器提供的原生能力。 SVG 全称叫可缩放矢量图，跟 HTML 一样，有自己的命名空间，也就是说有一系列的标签可以使用。而 Canvas 是 HTML5 中的新标签，用于客户端的图形绘制。Canvas 和 SVG 之间的一个重要的不同是，Canvas 有一个基于 JavaScript 的绘图 API，而 SVG 使用一个 XML 文档来描述绘图。SVG 可以轻松的被编辑，而 Canvas 只能清空画布后重新绘制。
HighCharts 是基于 SVG （现代浏览器中使用 SVG，老浏览器中使用的是 VML）开发的图表库。收费的，此处不做过多说明。
简单对比一下 ECharts 和 G2。ECharts 和 G2 都是基于 Canvas 开发，都有一套完善的图表和文档。ECharts 由百度开发，目前开源，功能也较为完善。G2 由蚂蚁金服开发，是一个语义化图表生成工具，它提供了一整套图形语法，开发者可以通过 G2 的语法搭建出多种图表。借用 ECharts 作者的一句话，G2 是面粉，ECharts 是面条，皆微小但美好。由于二者皆有比较完善的文档，此处不做详细说明。<br>
Three.js 是基于 <a href="https://zh.wikipedia.org/wiki/WebGL" target="_blank" rel="noopener noreferrer">WebGL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 开发的 3D 动画库，主要用于 3D 动画的制作，此处不做说明。
D3.js 基于 SVG 实现，为开发者提供了丰富的基于数据操作 DOM 的类库，目前最新的 V4 版本中也已经支持 Canvas。需要注意的是，D3 并没有划分具体的图表类型，还是提供了大量的绘图 API。</p> <p>了解了各个组件库的关系，我们就可以有目的的学习我们需要的内容了。</p> <h2 id="d3-的最小化说明"><a href="#d3-的最小化说明" aria-hidden="true" class="header-anchor">#</a> D3 的最小化说明</h2> <p>看过 D3 的文档的同学都会有这样的感觉，D3 的文档就像是若干根交织在一起的棉线，静静的放在那里，不多不少，就是没有头绪。这里对 D3 做一个最小化说明。所谓最小化说明就是能成功完成一个简单图表需要的最少的 API 使用说明。之后，我们可以据此延伸开去，系统的熟悉 D3 的能力。</p> <h3 id="_1-选择集与-data-join"><a href="#_1-选择集与-data-join" aria-hidden="true" class="header-anchor">#</a> 1. 选择集与 Data Join</h3> <p>前面已经说过，D3 是一个 JavaScript 类库，提供了一套根据数据操作 DOM 的 API。那么，首先我们就来说说如何通过 D3 操作 DOM。<br>
在此之前，我们先回想一下，通过 JavaScript 是如何操作 DOM 的。假设我们有如下页面（省略不必要部分）：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>这是一个段落<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>通过 JavaScript 改变段落字体颜色的方式可能如下：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.container p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么通过 D3 如何实现呢？</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'.container p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>怎么样，是不是跟原生 JavaScript 很像？这里我们使用了 D3 的选择集 API <a href="https://github.com/d3/d3-selection/blob/master/README.md#selection" target="_blank" rel="noopener noreferrer">Selection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。通过 Selection（选择集） 开发者可以设置页面元素的 attributes, styles, properties, HTML 或者 text 内容。那么问题来了，选择集 跟原生 JavaScript 有什么不同呢？首先，选择集支持链式语法，相信了解 JQuery 的同学都知道这个特性的好处。其次，D3 是一个数据驱动的类库，选择集提供了一套强大的数据驱动操作，那就是 <a href="https://github.com/d3/d3-selection/blob/master/README.md#joining-data" target="_blank" rel="noopener noreferrer">Data Join<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。
<img src="http:/.cbndata.org/tapas-fe/image/d3/data-join.png" alt="data-join"><br>
如上图所示，D3 将数据和选择集做了一些处理，将两者分成了三个部分，Enter、Update 和 Exit。数据是一个集合，选择集也是一个集合，如何通过数据来更新 DOM 呢。我们知道，选择集是 DOM 元素的集合，所有对选择集的操作都是对 DOM 元素的批量操作。<br>
假设我们有数据集</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选择集为</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> selection <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.container p'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从上面的 html 片段我们知道，选择集此时有一个元素。通过 data join</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>selection<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们得到了两个集合 update 和 enter，update 就是数据集和选择集匹配的部分，表示我有数据，你有元素，我们一一对应，类似于集合里面的交集概念。enter 表示数据集中除了 update 以外多出来的一部分，因为数据集比选择集大。此时我们通过</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>selection<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'add p tag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>就可以向选择集中添加 p 元素，此时所有 enter 集合都将进入 update 集合。<br>
经过上面的操作，'.container' 中已经包含了 4 个 p 元素，此时，我们更换一下数据集，</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>selection<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们将数据集缩小到只包含一个元素，经过 data join，产生两个集合，update 和 remove。update 不再多说，remove 是选择集中除了 update 以外多出来的部分。此时我们通过</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>selection<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>即可删除多余的元素。</p> <h3 id="比例尺-scale"><a href="#比例尺-scale" aria-hidden="true" class="header-anchor">#</a> 比例尺 Scale</h3> <p>我们知道，要想将数据展示到固定大小的图形中，就需要对数据进行归一化操作。所谓归一化，其实就是建立一个原始数据到图形数据的映射关系，有了这个映射关系，我们才知道将原始数据放到图形中的具体位置。<br>
D3 通过<a href="https://github.com/d3/d3-scale" target="_blank" rel="noopener noreferrer">Scale<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来完成归一化操作。D3提供了多种 Scale，有连续的，有离散的，都是为了适应不同数据，来建立原始数据到图形数据的映射关系。开发者可以根据原始数据类型选择对应的 Scale。</p> <h3 id="坐标轴-axis"><a href="#坐标轴-axis" aria-hidden="true" class="header-anchor">#</a> 坐标轴 Axis</h3> <p>要画图就离不开坐标轴，D3 提供了四个<a href="https://github.com/d3/d3-axis" target="_blank" rel="noopener noreferrer">坐标轴函数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> axisTop、axisRight、axisBottom、axisLeft，分别对应上、右、下、左。这四个函数的参数都是一个 Scale，就是前面说的比例尺。也就是说，我们只需要定义好坐标轴的比例尺，D3 会帮我们自动绘制坐标轴。<br>
除了定义比例尺以外，D3 还提供了一些定制坐标轴的 API，比如设置刻度线的个数，刻度线的显示文案等，详情请参考 API。</p> <h3 id="各种形状"><a href="#各种形状" aria-hidden="true" class="header-anchor">#</a> 各种形状</h3> <p>绘制完坐标轴以后，我们就需要绘制图表的核心内容图形了。图表有很多种，对应的图形也有很多种。比如经典的直线图、饼图等。<br>
D3 的 <a href="https://github.com/d3/d3-shape" target="_blank" rel="noopener noreferrer">Shape<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模块就定义了很多种图形。这里需要说明一点，Shape 模块只是生成要绘制的图形的数据，并不直接帮你绘制图形。开发者需要借助于前面提到的选择集和 Data Join 自行绘制图形。</p> <p>下面的代码演示了如何绘制环图：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pie <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">pie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取绘制饼图的函数</span>
<span class="token keyword">const</span> arcs <span class="token operator">=</span> <span class="token function">pie</span><span class="token punctuation">(</span>calcData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 pie 函数计算出一个包含起止弧度的对象数据，用于绘图使用</span>
<span class="token keyword">const</span> pathData <span class="token operator">=</span> arcs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> arc <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取圆弧路径计算函数</span>
  <span class="token keyword">const</span> arcConf <span class="token operator">=</span> <span class="token punctuation">{</span>
    innerRadius<span class="token punctuation">:</span> <span class="token number">157.5</span><span class="token punctuation">,</span>  <span class="token comment">// 设置圆环内径</span>
    outerRadius<span class="token punctuation">:</span> <span class="token number">170</span><span class="token punctuation">,</span>    <span class="token comment">// 设置圆环外径</span>
    startAngle<span class="token punctuation">:</span> item<span class="token punctuation">.</span>startAngle<span class="token punctuation">,</span> <span class="token comment">// 设置起始角度</span>
    endAngle<span class="token punctuation">:</span> item<span class="token punctuation">.</span>endAngle <span class="token comment">// 设置结束角度</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">arc</span><span class="token punctuation">(</span>arcConf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算出具体的圆弧路径数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>pathData<span class="token punctuation">)</span>  <span class="token comment">// data join</span>
  <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token comment">// 绘制 svg path</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>上述代码较为完整的展示了一个圆环的绘制过程。值得注意的是，Shape 只提供数据，最终我们还是需要自己通过选择集和 Data Join 才做 DOM 绘制图形。</p> <h3 id="其他高阶内容"><a href="#其他高阶内容" aria-hidden="true" class="header-anchor">#</a> 其他高阶内容</h3> <p>通过上面的介绍，我们已经了解了通过 D3 绘制图形的基本方法。由于篇幅和本篇文章定位限制，D3 提供的诸如地理图表、力学仿真等高阶内容，此处不做说明。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>D3 是一个强大的 JavaScript 类库，开发者可以方便的通过 D3 来完成数据驱动的图表绘制。虽然 D3 的文档篇幅浩大，但是缺乏系统性和必要的 Quick Start 指导，导致学习曲线比较陡峭，学习成本较高。本文是我最近一段时间学习 D3 的小总结，希望对后面学习 D3 的同学有一些帮助，也欢迎对 D3 感兴趣的同学一起讨论。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/13/2019, 3:05:16 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.1a92a99b.js" defer></script><script src="/assets/js/2.4bb95436.js" defer></script><script src="/assets/js/22.825b5c65.js" defer></script><script src="/assets/js/9.60a9ad14.js" defer></script>
  </body>
</html>
