<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Activity 必知 | Bingooo.Tang 的日志</title>
    <meta name="description" content="Activity 生命周期">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.45fd1eb4.css" as="style"><link rel="preload" href="/assets/js/app.1a92a99b.js" as="script"><link rel="preload" href="/assets/js/2.4bb95436.js" as="script"><link rel="preload" href="/assets/js/41.ead2592b.js" as="script"><link rel="preload" href="/assets/js/9.60a9ad14.js" as="script"><link rel="prefetch" href="/assets/js/10.ff19f3cc.js"><link rel="prefetch" href="/assets/js/11.e260adce.js"><link rel="prefetch" href="/assets/js/12.e1d4dc76.js"><link rel="prefetch" href="/assets/js/13.3780b65b.js"><link rel="prefetch" href="/assets/js/14.821eca39.js"><link rel="prefetch" href="/assets/js/15.947a489c.js"><link rel="prefetch" href="/assets/js/16.31117fc6.js"><link rel="prefetch" href="/assets/js/17.aa761a41.js"><link rel="prefetch" href="/assets/js/18.38e91cd9.js"><link rel="prefetch" href="/assets/js/19.2f0ddeb0.js"><link rel="prefetch" href="/assets/js/20.98a05b39.js"><link rel="prefetch" href="/assets/js/21.12bee07e.js"><link rel="prefetch" href="/assets/js/22.825b5c65.js"><link rel="prefetch" href="/assets/js/23.5a7523f8.js"><link rel="prefetch" href="/assets/js/24.d4db672e.js"><link rel="prefetch" href="/assets/js/25.9dc639ba.js"><link rel="prefetch" href="/assets/js/26.bb89ef52.js"><link rel="prefetch" href="/assets/js/27.9b952333.js"><link rel="prefetch" href="/assets/js/28.36b12119.js"><link rel="prefetch" href="/assets/js/29.b3fc89ab.js"><link rel="prefetch" href="/assets/js/3.914428ae.js"><link rel="prefetch" href="/assets/js/30.8403f552.js"><link rel="prefetch" href="/assets/js/31.3a71fc7c.js"><link rel="prefetch" href="/assets/js/32.f63547d0.js"><link rel="prefetch" href="/assets/js/33.30c37fb4.js"><link rel="prefetch" href="/assets/js/34.b1e97f3f.js"><link rel="prefetch" href="/assets/js/35.ab2a7a8c.js"><link rel="prefetch" href="/assets/js/36.5d422d5b.js"><link rel="prefetch" href="/assets/js/37.839e7d79.js"><link rel="prefetch" href="/assets/js/38.72e8bf2f.js"><link rel="prefetch" href="/assets/js/39.9a05368b.js"><link rel="prefetch" href="/assets/js/4.5c559b86.js"><link rel="prefetch" href="/assets/js/40.a8400673.js"><link rel="prefetch" href="/assets/js/42.2b99ba39.js"><link rel="prefetch" href="/assets/js/43.340f4287.js"><link rel="prefetch" href="/assets/js/44.6bf6391c.js"><link rel="prefetch" href="/assets/js/45.c33e2690.js"><link rel="prefetch" href="/assets/js/46.acfb4c4c.js"><link rel="prefetch" href="/assets/js/47.0d284677.js"><link rel="prefetch" href="/assets/js/48.7e5faf9d.js"><link rel="prefetch" href="/assets/js/49.70243ee5.js"><link rel="prefetch" href="/assets/js/5.4f064dd5.js"><link rel="prefetch" href="/assets/js/50.a70d1e3a.js"><link rel="prefetch" href="/assets/js/51.54705e9f.js"><link rel="prefetch" href="/assets/js/52.5e8b3d7e.js"><link rel="prefetch" href="/assets/js/53.03656bc8.js"><link rel="prefetch" href="/assets/js/54.d3b3024e.js"><link rel="prefetch" href="/assets/js/55.b8b66fcf.js"><link rel="prefetch" href="/assets/js/56.bcc27a01.js"><link rel="prefetch" href="/assets/js/57.dd12e611.js"><link rel="prefetch" href="/assets/js/6.8113e0b5.js"><link rel="prefetch" href="/assets/js/7.222800b2.js"><link rel="prefetch" href="/assets/js/8.84f16d44.js">
    <link rel="stylesheet" href="/assets/css/0.styles.45fd1eb4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Bingooo.Tang 的日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">教程</a></div><div class="nav-item"><a href="/tools/" class="nav-link">工具</a></div> <a href="https://github.com/bingoootang" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/tutorials/" class="nav-link">教程</a></div><div class="nav-item"><a href="/tools/" class="nav-link">工具</a></div> <a href="https://github.com/bingoootang" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="content default"><h1 id="activity-必知"><a href="#activity-必知" aria-hidden="true" class="header-anchor">#</a> Activity 必知</h1> <p>与 PC 应用总是从一个固定入口（比如 main 函数）启动不同，移动端应用的启动入口有很多。比如在一个应用中为了拨打电话可以直接打开拨号应用，而不需要用户主动启动拨号应用来拨号，那么对于拨号应用来说，它的启动入口是不确定的。为了应对这种交互模式，Android 系统通过 Activity 来实现。Activity 是 Android 应用的基石组件之一。一个 Activity 就是应用的一个页面（一屏），如果应用包含多个页面的话，就会有多个 Activity。同一个应用的 Activity 之间并不是强耦合在一起的，相反它们以一种松散的关系组合成应用。事实上，一个应用的 Activity 经常调用其他应用的 Activity，比如前面拨打电话的例子。Activity 之间通过 Intent 来互相调用。</p> <h2 id="状态与生命周期"><a href="#状态与生命周期" aria-hidden="true" class="header-anchor">#</a> 状态与生命周期</h2> <p>Activity 的生命周期以及各个生命周期之间的转换关系如下图所示：<br> <img src="/images/2018/activity-basics/lifecycle.jpg" alt="IMAGE"></p> <p>当 Activity 被创建后，首先触发 <code>onCreate()</code>，之后迅速触发 <code>onStart()</code>，此时页面开始可见，通常在这个生命周期中初始化页面 UI 相关代码。之后快速触发 <code>onResume()</code>，此时 Activity 可与用户交互。如果没有其他事件发生，Activity 将一直保持在 Resumed 状态下。当 Activity 转入后台时，触发 <code>onPaused()</code>，此时可以释放一些资源，比如相机等。当用户重新回到 Activity 时，会重新触发 <code>onResume()</code>，此时，需要重新初始化在 <code>onPaused()</code> 中被释放的资源。Paused 状态持续时间非常短暂，无法执行比较耗时的操作，比如保存数据、发起网络请求等。在 Activity 进入后台后，会触发 <code>onStop()</code>，此时可以进行数据保存、网络请求等耗时操作，同时也应该释放 CPU 密集的资源。当 Activity 被销毁时，触发 <code>onDestroy()</code>，在这个生命周期内，可以进行依稀应用状态数据缓存等操作。</p> <p>对应 Activity 各个生命周期的状态转换如下：<br> <img src="/images/2018/activity-basics/state.jpg" alt="IMAGE"></p> <blockquote><p>在应用中，如果存在生命周期敏感的组件，可以通过 <a href="https://developer.android.com/reference/android/arch/lifecycle/package-summary.html" target="_blank" rel="noopener noreferrer">android.arch.lifecycle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来实现，从而可以获取 Activity 状态变更之后的对应事件，如上图所示。</p></blockquote> <h2 id="状态变更"><a href="#状态变更" aria-hidden="true" class="header-anchor">#</a> 状态变更</h2> <p>通常，事件、用户触发或者系统触发都会导致 Activity 的状态发生变化。以下是一些常见的导致 Activity 状态变化的原因以及对应的状态变化。</p> <h4 id="_1-配置变更"><a href="#_1-配置变更" aria-hidden="true" class="header-anchor">#</a> 1.配置变更</h4> <p>有很多场景会导致配置发生变化，比如屏幕方向变化、系统语言变化等。当配置发生变更时，Activity 将会先被销毁再重新创建。因此，原先的 Activity 将会依次触发 <code>onPause()</code>，<code>onStop()</code>，<code>OnDestroy()</code> 生命周期，新的 Activity 会被创建并触发 <code>onCreate</code>，<code>onStart()</code>，<code>onResume()</code> 生命周期。</p> <blockquote><p>在多屏场景下，当用户打开新应用是，即使原来的 Activity 依然对用户可见，它的状态也会进入 Paused 状态。</p></blockquote> <h4 id="_2-其他-activity-或者对话框出现在前台（foreground）"><a href="#_2-其他-activity-或者对话框出现在前台（foreground）" aria-hidden="true" class="header-anchor">#</a> 2.其他 Activity 或者对话框出现在前台（foreground）</h4> <p>如果新的 Activity 或者对话框获得焦点并部分覆盖原来的 Activity，那么原来的 Activity 将会进入 Paused 状态，触发 <code>onPause()</code>，当被覆盖的 Activity 返回前台并获得焦点时，触发 <code>onResume()</code>。<br>
如果新的 Activity 或者对话框获得焦点并完全覆盖原来的 Activity，那么原来的 Activity 将会进入 Stopped 状态，触发 <code>onPause()</code> 和 <code>onStop()</code>，当被覆盖的 Activity 返回前台并获得焦点时，触发 <code>onRestart()</code>，<code>onStart()</code> 和 <code>onResume()</code>，如果被覆盖的 Activity 被重新初始化，则只会触发 <code>onStart()</code> 和 <code>onResume()</code>。</p> <h4 id="_3-用户点击返回按钮"><a href="#_3-用户点击返回按钮" aria-hidden="true" class="header-anchor">#</a> 3.用户点击返回按钮</h4> <p>当用户点击返回按钮时，系统会认为这是用户主动退出并不在返回，因此会销毁 Activity，触发 <code>onPause()</code>，<code>onStop()</code> 和 <code>onDestroy()</code>。</p> <h4 id="_4-系统杀死了应用进程"><a href="#_4-系统杀死了应用进程" aria-hidden="true" class="header-anchor">#</a> 4.系统杀死了应用进程</h4> <p>当系统资源不足，为了给前台的进程提供足够的资源，会选择杀死一些暂时对用户不可见的进程，以下表格展示的是进程被系统杀死的可能性以及对应的进程和 Activity 状态。</p> <table><tr><td>被系统杀死的可能性</td> <td>进程状态</td> <td>Activity 状态</td></tr> <tr><td>低</td> <td>前台（拥有或者即将拥有焦点）</td> <td>Created<br>Started<br>Resumed</td></tr> <tr><td>中</td> <td>后台（失去焦点）</td> <td>Paused</td></tr> <tr><td>高</td> <td>后台（不可见）<hr>空</td> <td>Stopped<hr>Destroyed</td></tr></table> <p><strong>参考链接</strong></p> <ul><li><a href="https://developer.android.com/guide/components/activities/intro-activities" target="_blank" rel="noopener noreferrer">https://developer.android.com/guide/components/activities/intro-activities<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.android.com/guide/components/activities/activity-lifecycle" target="_blank" rel="noopener noreferrer">https://developer.android.com/guide/components/activities/activity-lifecycle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.android.com/guide/components/activities/state-changes" target="_blank" rel="noopener noreferrer">https://developer.android.com/guide/components/activities/state-changes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.android.com/topic/libraries/architecture/lifecycle" target="_blank" rel="noopener noreferrer">https://developer.android.com/topic/libraries/architecture/lifecycle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/13/2019, 3:05:16 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.1a92a99b.js" defer></script><script src="/assets/js/2.4bb95436.js" defer></script><script src="/assets/js/41.ead2592b.js" defer></script><script src="/assets/js/9.60a9ad14.js" defer></script>
  </body>
</html>
